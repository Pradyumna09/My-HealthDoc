<!DOCTYPE html>
<html>
  <head>
    <title>Add Visit Report</title>
	<link href="fonts/material-icons/iconfont/material-icons.css" rel="stylesheet">

    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.css" media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script type="text/javascript" charset="utf-8" src="js/camera.js"></script>
	 
	<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/materialize.js"></script>
	<script type="text/javascript" src="js/AddReport.js"></script>	  

    <script src="Login.js"></script>
    <script src="Logout.js"></script>
    <style>
	
    .table-striped>tbody>tr:nth-of-type(odd) {
    background-color: #E0E0E0;
}
	.inputfile-4 + label figure, .capture_cam{
		width: 90px;
		height: 90px;
		border-radius: 50%;
		background-color: #ef3864;
		display: block;
		padding: 28px;
		margin: 0 auto 10px;
		color:#fff;
		box-shadow: 0 10px 20px #999, inset 0px 1px 5px #676767, 0 -10px 20px #f3f3f3;
	}
	.inputfile {
		width: 0.1px;
		height: 0.1px;
		opacity: 0;
		overflow: hidden;
		position: absolute;
		z-index: -1;
	}
	.up_file, .up_cam{
	  width: 25%;
      float: left;
	      margin-left: 15%;
	}
	.up_file{
	  text-align: center;
	}
	 
	
	tbody td, thead th {
		width: 30%;	
	}
	tbody {
			
		overflow-y: auto;    /* Trigger vertical scroll    */
		overflow-x: hidden;  /* Hide the horizontal scroll */
		
		}
		.view_file_list{
		       text-align: center;
				font-size: 19px;
				font-weight: 400; 
				margin-bottom: 10px;
		}
    </style>
  </head>
  <body>
  
   <ul id="slide-out" class="side-nav">
        <li>
            <div class="user-view">
                <div class="background">

                </div>
                <a href="#!user">
                    <img class="circle" src="images/yuna.jpg">
                </a>
                <a href="#!name">
                    <span id="loginname" class="white-text name">Username</span>
                </a>
                
            </div>
        </li>
        <li >
            <a class="waves-effect" href="Menu.html">
                <i class="material-icons">dashboard</i>Dashboard</a>
        </li>
        <li>
            <div class="divider"></div>
        </li>   
	
		<li >
            <a class="waves-effect" href="DemographicDetails.html">
                <i class="material-icons">group</i>Demographic Details</a>
        </li>
		<li>
            <div class="divider"></div>
        </li>        
		
	 
		<li>
            <a class="waves-effect"  href="DoctorList.html">
                <i class="material-icons">person</i>Consulting Doctors</a>
        </li>
		 <li>
            <div class="divider"></div>
        </li> 
         <li>
            <a class="waves-effect" href="AddDocVisit.html">
                <i class="material-icons">add_box</i>Add Doctor Visit</a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
		<li class="activated">
            <a class="waves-effect" href="VisitList.html">
                <i class="material-icons">file_upload</i>Upload Reports</a>
        </li>
		<li>
            <div class="divider"></div>
        </li>
		
		<li>
            <a class="waves-effect" href="Reports.html">
                <i class="material-icons">assignment_turned_in</i>View Reports</a>
        </li>
		<li>
            <div class="divider"></div>
        </li>
		<li>
            <a class="waves-effect" href="InsuranceList.html">
                <i class="material-icons">description</i>Health Insurance</a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
		
		<li>
            <a class="waves-effect" href="AddEmergencyNoList.html">
                <i class="material-icons">call</i>Emergency Call</a>
        </li>	
		<li>
            <div class="divider"></div>
        </li>
		
		<li>
            <a class="waves-effect" href="Setting.html">
                <i class="material-icons">settings</i>Setting</a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
        <li>
            <a class="waves-effect" onClick="logout();">
                <i class="material-icons">power_settings_new</i>Logout</a>
        </li>
        <li>
            <div class="divider"></div>
        </li>
    </ul>

	<div class="mn">
	<nav class="nav-extended">
        <div class="nav-wrapper">
            <a href="#!" class="left brand-logo waves-effect" data-activates="slide-out">
                <i class="material-icons menu">menu</i>
            </a>
            <span style="margin-left: 4rem;font-size: 1.5rem;">Add Visit Report</span>
			<a href="Notification.html" class="noti"><i class="material-icons">notifications</i></a>
        </div>
    </nav>
	<div class="row" style="overflow: auto; margin-bottom:0px;">
	<form id="report-form" name="report-form" action="" method="post" enctype="multipart/form-data">	
	 <div class="col s12 m12"> <div class="input-field col s12 m4">
                <label>Report Name </label>
				<input type="text" id="visit_report_name" name="visit_report_name"/>				
			  </div>
			  <div class="input-field col s12 m4">
                <label>Upload File </label>
			
			<div class="input-field col s12 m12" style="margin-bottom: 1rem;">
				<div class="file-upload">
				  <div class="file-select">
					<div class="file-select-button" id="fileName">Choose File</div>
					<div class="file-select-name" id="noFile">No file chosen...</div> 
					<input type="file" id="file" name="upload_report[]"  value="Upload" class="col s12 m12 chooseFile" /> 
				  </div>
				</div> 
			</div>
			
			  </div>
		<div class="row">	
			<div class="input-field col s12 m12" style="margin-bottom: 1rem;">
				 <a onmousedown="SaveReport();" id="save" class="col s12 m12 waves-effect waves-light btn modal-trigger btn-block">Add Report</a>
			</div>
		</div>
		
		<div class="row">
            <div class="view_file_list">View uploaded Files</div>		
			<table  name="myrole" class='table-striped' > 
			<thead>
			<tr>
				<th >Report Name</th>
				<th >Date</th>    
			</tr>
			</thead>
			<tbody id="myrole" class="well-lg"></tbody>
			</table>
			
		</div>
		 <input type="hidden" name="visit_id" id="visit_id">
		  <div id="modal1" class="modal">
                    <div class="modal-content">
					<a id="close" class="waves-effect waves-light modal-close" style="float:right;color:#000;"><i class="material-icons menu">close</i></a>
                        <div class="input-field col s12 m12">
                            <img id="display_img" style="width:100%"/>
                        </div>
                        <div id="panelID"></div>
                    </div>
                </div></div>
	</form></div>
  <img id="loading_img" style="width: 20%;text-align: center;position: absolute;top: 24%;left: 40%;z-index: 1;display:none;" src="images/uploading.gif" >
  </body>
 
  <script type="text/javascript"> 

 $('.brand-logo').sideNav({
            menuWidth: 300, // Default is 300
            edge: 'left', // Choose the horizontal origin
            closeOnClick: true, // Closes side-nav on <a> clicks, useful for Angular/Meteor
            draggable: true, // Choose whether you can drag to open on touch screens,
            onOpen: function (el) { /* Do Stuff */ }, // A function to be called when sideNav is opened
            onClose: function (el) { /* Do Stuff */ }, // A function to be called when sideNav is closed
        });
		
	var visit_id = localStorage.getItem('visit_id');	
	var loginname = localStorage.getItem('user_name');
	var User_id = localStorage.getItem('u_id');
	//alert(User_id);
	$("#visit_id").val(visit_id); 
    //alert(visit_id);	
    $('#loginname').text(loginname);
	

	
$(function(){

try{
             $.ajax({
                               
                        type: "POST",
						url: "https://www.manoramahealthcare.com/health_record_organizer/visit_report_list.php",
                        data : 'visit_id=' + visit_id, 
						 success: function (msg)
                            {
								 var parseJson = JSON.parse(msg);    
									 //alert(parseJson[1].role_name)
								//$("#myrole").append('<tr class="collection-item" style="font-weight:bold;text-align:center;"><td>File Name</td> class="collection-item" style="font-weight:bold;text-align:center"><td>Date</td></tr>');
	console.log(parseJson.message);
	if(parseJson.result == false){
	
	$("#myrole").append("<span class='norecord'>No Visit Added</span>");
	return false;
	
	}else{
	for(var i =0;i < parseJson.message.length;i++)
			{
				$("#myrole").append('<tr data-img="'+parseJson.message[i].visit_report_file_name+'"class="fname"><td>'+fn(parseJson.message[i].visit_report_name,20)+'</td>'+'<td >'+ parseJson.message[i].visit_report_created_at+'</td></tr>');								
			}

function fn(text, count){
    return text.slice(0, count) + (text.length > count ? "..." : "");
}
								
		$(".fname").click(function(){
			var img = $(this).attr('data-img');
			
			$('#display_img').attr('src','');
			$('#display_img').attr('src','https://www.manoramahealthcare.com/health_record_organizer/uploads/report/'+img);		
			$("#modal1").modal('open');
			
		});	
		
		}		
			},
					});
                } catch(e){
                	if(e.status == '0'){
                	//	alert("Request failed");
                	
                		$("#image_id").hide();
                	} else if(e.status == '404') {
                	//	alert("Page not found");
                	
                		$("#image_id").hide();
                	} else if(e.status == '500') {
                	//	alert("Internal Server Error.");
                	
                		$("#image_id").hide();
                	}
                	  else {
                		$("#image_id").hide();
                		return; //skip this error
                	}
                }
				$('.modal').modal();
 	
});

$('.chooseFile').bind('change', function () {
	  var filename = $(".chooseFile").val();
	  if (/^\s*$/.test(filename)) {
		$(".file-upload").removeClass('active');
		$("#noFile").text("No file chosen..."); 
	  }
	  else {
		$(".file-upload").addClass('active');
		$("#noFile").text(filename.replace("C:\\fakepath\\", "")); 
	  }
	});

</script>
</html>